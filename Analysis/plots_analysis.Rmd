---
title: "Plots and Analysis"
author: "Andrew"
date: "7/20/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Plots and Analysis
library(here)
library(ggplot2)
library(tidyr)
library(dplyr)
library(wesanderson)

```

## Plots and Analysis

```{r readData, echo=FALSE}
# Read in the processed data
data <- read.csv(here("data_4_analysis/All_Stream_Data.csv"))
data$DateTime <- as.POSIXct(data$DateTime)
```

### CO2 (Station 1) vs Chlorophyl A
```{r CO2vChlA, eval=TRUE, warning=FALSE, echo=FALSE, fig.width=12}
# Plot CO2 vs. Chlorophyl A
CO2vChlA <- ggplot(data, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
  geom_point(aes(y = Chlorophylla_ug.L * 500, colour = "Chlorophyl A"))+
  scale_y_continuous(sec.axis = sec_axis(~./500, name = "ug/L"))+
  labs(x = "Date", y = "CO2 ppm")

CO2vChlA
```

#### Notes
Chlorophyl A spikes starting on Sunday July 14 at ~10:45am and peaking at ~5:45pm that afternoon. This seems to be associated with the heavy rainfall that was experienced during that day. This also suggests that CO2 is undergoing dilution by the same rainfall. This may suggest that Chlorphyl A and CO2 have an inverse relationship.


### CO2 (Station 1) vs Phycocyanin
```{r CO2vPhyco, eval=TRUE, warning=FALSE, echo=FALSE, fig.width=12}
# Plot CO2 vs. Phycocyanin
CO2vPhyco <- ggplot(data, aes(x = DateTime))+
  geom_point(aes(y = V1,colour = "Vaisala 1"))+
  geom_point(aes(y = Phycocyanin_ppb * 10, colour = "C6 Phycocyanin"))+
  scale_y_continuous(sec.axis = sec_axis(~./10, name = "Phycocyanin ppb"))+
  labs(x = "Date", y = "CO2 ppm", colour = "Sensor")

CO2vPhyco

```

### Notes
Phycocyanin spikes hard beginning at 4:00 am on July 15 and peaking at 7:15am that same morning. It is unclear what may have caused this.

Filtering out this spike reveals this:

```{r phycoFilt, echo=TRUE, warning=FALSE, fig.width=12}
phycoFilt <- data%>%
  filter(data$Phycocyanin_ppb < 50)

CO2vPhycoFilt <- ggplot(phycoFilt, aes(x = DateTime))+
  geom_point(aes(y = V1,colour = "Vaisala 1"))+
  geom_point(aes(y = Phycocyanin_ppb * 250, colour = "C6 Phycocyanin"))+
  scale_y_continuous(sec.axis = sec_axis(~./250, name = "Phycocyanin ppb"))+
  labs(x = "Date", y = "CO2 ppm", colour = "Sensor")

CO2vPhycoFilt
```


### CO2 vs. ppt
```{r CO2ppt, echo=FALSE, warning=FALSE, fig.width=12}
CO2 <- data%>%
  select(DateTime,V1,V2,V3,V4)%>%
  gather(VID,PPM,-DateTime)

# Import ppt data
ppt <- read.csv(here("data_4_analysis/ppt.csv"))
ppt$Date <- as.POSIXct(ppt$Date, format = "%m/%d/%Y")

CO2plot <- ggplot()+
  geom_bar(data = ppt, aes(x = Date, y = ppt_mm * 100), stat = "identity", alpha = 0.2, color = '#00aaff')+
  geom_point(data = CO2, aes(x = DateTime, y = PPM, colour = VID))+
  scale_y_continuous(sec.axis = sec_axis(~./100, name = "Daily ppt (mm)"))+
  labs(x = "Date", y = "CO2 ppm")

CO2plot

```


### Notes
There seems to be a strong inverse relationship between CO2 concentrations and rainfall. I imagine CO2 builds up under drier conditions and is flushed out with rainfall events.


### CO2 at Stations 1 & 2 vs. eosFD Flux between stations 1 and 2
```{r PPMvFlux, echo = FALSE, warning=FALSE, fig.width= 12}
# Filter to only Vaisala 1 and 2
CO2Filt <- CO2%>%
  filter(VID %in% c("V1","V2"))

# Filter eos1 Data
eos1 <- data%>%
  select(DateTime, Flux_1)%>%
  na.omit()%>%
  mutate(Sensor = "eosFD")

# Plot
CO2vFlux <- ggplot()+
  geom_bar(data = ppt, aes(x = Date, y = ppt_mm * 100), stat = "identity", alpha = 0.2, color = '#00aaff')+
  geom_point(data = CO2Filt, aes(x = DateTime, y = PPM, colour = VID))+
  geom_point(data=eos1, aes(x = DateTime, y = Flux_1*1000, colour = Sensor))+
  scale_y_continuous(sec.axis = sec_axis(~./1000, name = "micromols per square meter per second"))+
  scale_colour_manual(values = c("#ea8e15","#c23d86","#67be41"), labels = c("eosFD","Vaisala 1","Vaisala 2"))
  
  

CO2vFlux
```

### Notes
This plot suggests an almost 1:1 relationship between flux and dissolved CO2. Flux is multiplied by 1,000 for the purposes of visualization


