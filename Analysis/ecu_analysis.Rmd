---
title: "Ecuador: Data Analysis"
author: "Maribel Herrera"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(dplyr)
library(ggplot2)
library(plotly)
```
## Synoptic- Vaisala
```{r synoptic, echo=FALSE, warning=FALSE}
Synoptics <- read.csv(here("FieldData/Vaisala/Synoptics2.csv"))
plot <- ggplot(Synoptics) +
  geom_point(aes(x= Distance, y= Syn1_071819), color= "blue", size = 2) +
  geom_point(aes(x= Distance, y= Syn2_072519), color= "cornflowerblue", size = 2) +
  geom_point(aes(x= Distance, y= Syn3_072919), color= "darkgoldenrod1", size = 2) +
  geom_point(aes(x= Distance, y= Syn4_073119), color= "darkolivegreen3", size = 2) +
  geom_point(aes(x= Distance, y= Syn5_080619), color= "darkgreen", size = 2) +
  geom_point(aes(x= Distance, y= Syn6_081219), color= "darkblue", size = 2) +
  labs(x = "Distance from Upstream (m)", y= "pCO2") +
  ggtitle("Synoptics") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(plot)
```

## Synoptic Average & Standard Deviation

Decrease beginning at about 37m from upstream (Synoptic point 29)
unil 124m from upstream (Synoptic point 18: right under waterfall)
 

**(107m =Waterfall)**        

```{r synavg, echo=FALSE, warning=FALSE}

syn <- read.csv(here("FieldData/Vaisala/synavg.csv"))

plot1 <- ggplot(syn) + 
  geom_errorbar(aes(x= Distance, y= Avg, ymin= Avg - Stdv, ymax= Avg + Stdv), width=0.2, size=1, color="darkblue") +   
  geom_point(aes(x= Distance, y= Avg), color = "darkblue", size = 2) +   
  labs(x = "Distance from Upstream (m)", y = "pCO2)") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(plot1)
```

## All Ecuador Vaisala Data 

```{r vdata, echo=FALSE, warning=FALSE}

# This is a temporary script meant to correct time stamps for the Vaisala data
# Some of the data re in 12-hour format and some are in 24-hour
# This seems to be related to the data loggers pulling settingfs based on what
# computer they were connected to

# Import the Vaisala data for the date specified above.
V1Files <- list.files(path = here("FieldData/Vaisala"), pattern = "VB1")
V2Files <- list.files(path = here("FieldData/Vaisala"), pattern = "VB2")
V3Files <- list.files(path = here("FieldData/Vaisala"), pattern = "VB3")
V4Files <- list.files(path = here("FieldData/Vaisala"), pattern = "VB4")

### Create an empty data frame
V1Data24 <- data.frame()

# Import files that have 24hour time format
for(i in 1:10){
  file <- V1Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
  data <- data[c(1,2,ncol(data))]   # Some of the files had two extra colums
  V1Data24 <- rbind(V1Data24,data)
}

# Convert time to POSIXct in a new column called "DateTime"
V1Data24$DateTime <- paste0(V1Data24$Date," ",V1Data24$Time)
V1Data24$DateTime <- as.POSIXct(V1Data24$DateTime, format = "%m/%d/%Y %H:%M:%S")

# Import files in AM/PM
V1Data12 <- data.frame()
for(i in 11:24){
  file <- V1Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
#  print(paste0(V1Files[i],": ", ncol(data)))
  data <- data[c(1,2,ncol(data))]   # Some of the files had two extra colums
  V1Data12 <- rbind(V1Data12,data)
}
# Convert time to POSIXct in a new column called "DateTime"
V1Data12$DateTime <- paste0(V1Data12$Date," ",V1Data12$Time)
V1Data12$DateTime <- as.POSIXct(V1Data12$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

### Combine Vaisala 1 data
V1Data <- rbind(V1Data24,V1Data12)

# Format the data, adjust based on field calibration and remove duplicate rows
V1Data <- V1Data%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  select(DateTime,PPM,VID)%>%
  distinct()


# Vaisala #2: 1-10 are in 24-hour, skipping 11 (VB2_08132019_1min) because I don't know how it
# was created or really where it came from #12 is the only file in AM/PM

V2Data12 <- read.csv(here::here("FieldData/Vaisala/VB2_08152019_1min.csv"))
V2Data12$CO2 <- V2Data12$CO2*10
V2Data12$DateTime <- paste0(V2Data12$Date," ",V2Data12$Time)
V2Data12$DateTime <- as.POSIXct(V2Data12$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

V2Data12 <- V2Data12%>%
  mutate("VID" = "V2")%>%
  select(DateTime,CO2,VID)
colnames(V2Data12) <- c("DateTime","PPM","VID")
V2Data12$PPM <- V2Data12$PPM - 30

# Sensor 2 24 hour data
V2Data <- data.frame()
for(i in 1:10){
  file <- V2Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
#  print(paste0(V2Files[i],": ", ncol(data)))
  V2Data <- rbind(V2Data,data)
}

V2Data$DateTime <- paste0(V2Data$Date," ",V2Data$Time)
V2Data$DateTime <- as.POSIXct(V2Data$DateTime, format = "%m/%d/%Y %H:%M:%S")

V2Data <- V2Data%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# The Omega data logger fried (broke) some time on July 22nd
# It appears there was some erratic data recorded prior to 
# it failing all together. The x-axis starts at 16:00 on July 22nd 
# which was a night time injection and ends at July 23rd at 10:25. 
# The injection ended at 19:45 (big drop). The Vaisala readings at 
# Station 1 (red dots) and station 2 begin to diverge at 22:44 on July 22nd.
# We filter out data after 22:00 as non-real data
V2Data <- rbind(V2Data,V2Data12)%>%
  distinct()%>%
  filter(DateTime < as.POSIXct("2019-07-22 22:00:00")|DateTime>as.POSIXct("2019-07-26 00:00:00"))%>% #Omega malfunction
  filter(DateTime < as.POSIXct("2019-08-01 16:30:00")|DateTime>as.POSIXct("2019-08-03 10:30:00"))%>% #Unknown cr300 malfunction
  filter(DateTime < as.POSIXct("2019-08-08 11:36:00")|DateTime>as.POSIXct("2019-08-09 10:05:00"))    #Unknown cr300 malfunction



# Sensor 3

# AM/PM: 11-24
V3Data24 <- data.frame()

# Import files that have 24hour time format
for(i in 1:10){
  file <- V3Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
  data <- data[c(1,2,ncol(data))]   # Some of the files had two extra colums
  V3Data24 <- rbind(V3Data24,data)
}

# Convert time to POSIXct in a new column called "DateTime"
V3Data24$DateTime <- paste0(V3Data24$Date," ",V3Data24$Time)
V3Data24$DateTime <- as.POSIXct(V3Data24$DateTime, format = "%m/%d/%Y %H:%M:%S")

# Import files in AM/PM
V3Data12 <- data.frame()
for(i in 11:24){
  file <- V3Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
#  print(paste0(V3Files[i],": ", ncol(data)))
  data <- data[c(1,2,ncol(data))]   # Some of the files had two extra colums
  V3Data12 <- rbind(V3Data12,data)
}
# Convert time to POSIXct in a new column called "DateTime"
V3Data12$DateTime <- paste0(V3Data12$Date," ",V3Data12$Time)
V3Data12$DateTime <- as.POSIXct(V3Data12$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

### Combine Vaisala 1 data
V3Data <- rbind(V3Data24,V3Data12)

# Format the data, adjust based on field calibration and remove duplicate rows
V3Data <- V3Data%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()



# Sensor 4

# AM/PM: 11-22
V4Data24 <- data.frame()

# Import files that have 24hour time format
for(i in 1:10){
  file <- V4Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
# print(paste0(V4Files[i],": ", ncol(data)))
  data <- data[c(1,2,5)]   # Some of the files had two extra colums
  V4Data24 <- rbind(V4Data24,data)
}

# Convert time to POSIXct in a new column called "DateTime"
V4Data24$DateTime <- paste0(V4Data24$Date," ",V4Data24$Time)
V4Data24$DateTime <- as.POSIXct(V4Data24$DateTime, format = "%m/%d/%Y %H:%M:%S")

# Import files in AM/PM
V4Data12 <- data.frame()
for(i in 11:22){
  file <- V4Files[i]
  data <- read.csv(here::here("FieldData/Vaisala",file),
                   blank.lines.skip = TRUE, header = TRUE)
#  print(paste0(V4Files[i],": ", ncol(data)))
  data <- data[c(1,2,ncol(data))]   # Some of the files had two extra colums
  V4Data12 <- rbind(V4Data12,data)
}
# Convert time to POSIXct in a new column called "DateTime"
V4Data12$DateTime <- paste0(V4Data12$Date," ",V4Data12$Time)
V4Data12$DateTime <- as.POSIXct(V4Data12$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

### Combine Vaisala 1 data
V4Data <- rbind(V4Data24,V4Data12)

# Format the data, adjust based on field calibration and remove duplicate rows
V4Data <- V4Data%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(V1Data,V2Data,V3Data,V4Data)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Make a simple plot
outplot <- ggplot(VMerge, aes(x = DateTime, y = PPM, group = VID))+
  geom_point(aes(col=VID), size = .5) +
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9")) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(outplot)

```

## Injections

|Date|Start|End|Notes|
|:--:|:---:|:-:|:---:|
|July 12|13:00|16:00|Started at 11:47 but had to be restarted since we had to reset sensors|
|July 16|14:15|20:00|Night Injection|
|July 22|16:25|19:45|Night Injection|
|July 26|12:45|14:45|Day Injection|
|August 1|16:00|20:00|Night Injection, No V4 because no connection to battery, weird CR300 reading for V2|
|August 5|16:35|20:00|Night Injection|
|August 8|12:43|15:25|Day Injection|

```{r subset, echo=FALSE, warning=FALSE}
data <- read.csv(here("data_4_analysis/All_Stream_Data.csv"))
data$DateTime <- as.POSIXct(data$DateTime)
inj1 <- data%>%
  filter(DateTime > as.POSIXct("2019-07-12 12:30:00"))%>%
  filter(DateTime < as.POSIXct("2019-07-12 16:30:00"))

plot3 <- ggplot(inj1, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(y = V2, colour = "Vaisala 2"))+
  geom_point(aes(y = V3, colour = "Vaisala 3"))+
  geom_point(aes(y = V4, colour = "Vaisala 4"))+
  labs(title = "Injection #1 - July 12", x = "Time", y = "pCO2", colour = "Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(plot3)
```

```{r inj2, echo=FALSE, warning=FALSE}
inj2 <- data%>%
  filter(DateTime > as.POSIXct("2019-07-16 13:30:00"))%>%
  filter(DateTime < as.POSIXct("2019-07-16 21:00:00"))
plot4 <- ggplot(inj2, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(y = V2, colour = "Vaisala 2"))+
  geom_point(aes(y = V3, colour = "Vaisala 3"))+
  geom_point(aes(y = V4, colour = "Vaisala 4"))+
  labs(title = "Injection #2 - July 16", x = "Time", y = "pCO2", colour ="Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggplotly(plot4)
```

```{r inj3, echo=FALSE, warning=FALSE}
inj3 <- data%>%
  filter(DateTime > as.POSIXct("2019-07-22 13:30:00"))%>%
  filter(DateTime < as.POSIXct("2019-07-22 21:00:00"))

plot5 <- ggplot(inj3, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(y = V2, colour = "Vaisala 2"))+
  geom_point(aes(y = V3, colour = "Vaisala 3"))+
  geom_point(aes(y = V4, colour = "Vaisala 4"))+
  labs(title = "Injection #3 - July 22", x = "Time", y = "pCO2", colour = "Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(plot5)
```

```{r inj4, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_07262019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_07262019_1min.csv"))
VB4<- read.csv(here::here("FieldData/Vaisala/VB4_07262019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB4 <- VB4%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3,VB4)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-07-26 11:45:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-07-26 15:45:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
outPlot3 <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #4 - July 26", x = "Time", y = "pCO2", colour = "Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(outPlot3)
```

```{r inj5, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_08012019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_08022019_1min.csv"))
#VB4<- read.csv(here::here("FieldData/Vaisala/VB4_08062019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
#VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

#VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
#VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

#VB4 <- VB4%>%
#  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
#  select(DateTime,PPM,VID)%>%
#  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-08-01 15:00:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-08-01 21:00:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
#"#63ABF9"
outPlot2 <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #5 - August 01",x = "Time", y = "pCO2", colour = "Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(outPlot2)
```


```{r inj6, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_08062019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_08062019_1min.csv"))
VB4<- read.csv(here::here("FieldData/Vaisala/VB4_08062019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
#VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB4 <- VB4%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3,VB4)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-08-05 14:00:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-08-05 21:00:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
outPlot1 <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9","#63ABF9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #6 - August 05", x = "Time", y = "pCO2", colour = "Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(outPlot1)
```


```{r inj7, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_08092019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_08092019_1min.csv"))
VB4<- read.csv(here::here("FieldData/Vaisala/VB4_08092019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
#VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB4 <- VB4%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3,VB4)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-08-08 12:00:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-08-08 16:00:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
outPlot <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9","#63ABF9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #7 - August 08", x = "Time", y = "pCO2", colour = "Sensor") +
  theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

ggplotly(outPlot)
```