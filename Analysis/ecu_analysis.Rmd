---
title: "Ecuador: Data Analysis"
author: "Maribel Herrera"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(dplyr)
library(ggplot2)
library(plotly)
```
## Synoptic- Vaisala
```{r synoptic, echo=FALSE, warning=FALSE}
Synoptics <- read.csv(here("FieldData/Vaisala/Synoptics2.csv"))
plot <- ggplot(Synoptics) +
  geom_point(aes(x= Distance, y= Syn1_071819), color= "blue", size = 2) +
  geom_point(aes(x= Distance, y= Syn2_072519), color= "cornflowerblue", size = 2) +
  geom_point(aes(x= Distance, y= Syn3_072919), color= "darkgoldenrod1", size = 2) +
  geom_point(aes(x= Distance, y= Syn4_073119), color= "darkolivegreen3", size = 2) +
  geom_point(aes(x= Distance, y= Syn5_080619), color= "darkgreen", size = 2) +
  geom_point(aes(x= Distance, y= Syn6_081219), color= "darkblue", size = 2) +
  labs(x = "Distance from Upstream (m)", y= "pCO2") +
  ggtitle("Synoptics")
ggplotly(plot)
```

## Synoptic Average & Standard Deviation

Decrease beginning at about 37m from upstream (Synoptic point 29)
unil 124m from upstream (Synoptic point 18: right under waterfall)
 

**(107m =Waterfall)**        

```{r synavg, echo=FALSE, warning=FALSE}

syn <- read.csv(here("FieldData/Vaisala/synavg.csv"))

plot1 <- ggplot(syn) + 
  geom_errorbar(aes(x= Distance, y= Avg, ymin= Avg - Stdv, ymax= Avg + Stdv), width=0.2, size=1, color="darkblue") +   
  geom_point(aes(x= Distance, y= Avg), color = "darkblue", size = 2) +   
  labs(x = "Distance from Upstream (m)", y = "pCO2)") 

ggplotly(plot1)
```

## Injections

|Date|Start|End|Notes|
|:--:|:---:|:-:|:---:|
|July 12|13:00|16:00|Started at 11:47 but had to be restarted since we had to reset sensors|
|July 16|14:15|20:00|Night Injection|
|July 22|16:25|19:45|Night Injection|
|July 26|12:45|14:45|Day Injection|
|August 1|16:00|20:00|Night Injection, No V4 because no connection to battery, weird CR300 reading for V2|
|August 5|16:35|20:00|Night Injection|
|August 8|12:43|15:25|Day Injection|

```{r subset, echo=FALSE, warning=FALSE}
data <- read.csv(here("data_4_analysis/All_Stream_Data.csv"))
data$DateTime <- as.POSIXct(data$DateTime)
inj1 <- data%>%
  filter(DateTime > as.POSIXct("2019-07-12 12:30:00"))%>%
  filter(DateTime < as.POSIXct("2019-07-12 16:30:00"))

plot3 <- ggplot(inj1, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(y = V2, colour = "Vaisala 2"))+
  geom_point(aes(y = V3, colour = "Vaisala 3"))+
  geom_point(aes(y = V4, colour = "Vaisala 4"))+
  labs(title = "Injection #1 - July 12", x = "Time", y = "pCO2", colour = "Sensor")

ggplotly(plot3)
```

```{r inj2, echo=FALSE, warning=FALSE}
inj2 <- data%>%
  filter(DateTime > as.POSIXct("2019-07-16 13:30:00"))%>%
  filter(DateTime < as.POSIXct("2019-07-16 21:00:00"))
plot4 <- ggplot(inj2, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(y = V2, colour = "Vaisala 2"))+
  geom_point(aes(y = V3, colour = "Vaisala 3"))+
  geom_point(aes(y = V4, colour = "Vaisala 4"))+
  labs(title = "Injection #2 - July 16", x = "Time", y = "pCO2", colour ="Sensor")
ggplotly(plot4)
```

```{r inj3, echo=FALSE, warning=FALSE}
inj3 <- data%>%
  filter(DateTime > as.POSIXct("2019-07-22 13:30:00"))%>%
  filter(DateTime < as.POSIXct("2019-07-22 21:00:00"))

plot5 <- ggplot(inj3, aes(x = DateTime))+
  geom_point(aes(y = V1, colour = "Vaisala 1"))+
    scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(y = V2, colour = "Vaisala 2"))+
  geom_point(aes(y = V3, colour = "Vaisala 3"))+
  geom_point(aes(y = V4, colour = "Vaisala 4"))+
  labs(title = "Injection #3 - July 22", x = "Time", y = "pCO2", colour = "Sensor")
ggplotly(plot5)
```

```{r inj4, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_07262019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_07262019_1min.csv"))
VB4<- read.csv(here::here("FieldData/Vaisala/VB4_07262019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB4 <- VB4%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3,VB4)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-07-26 11:45:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-07-26 15:45:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
outPlot3 <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9", "#63ABF9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #4 - July 26", x = "Time", y = "pCO2", colour = "Sensor")

ggplotly(outPlot3)
```

```{r inj5, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_08012019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_08022019_1min.csv"))
#VB4<- read.csv(here::here("FieldData/Vaisala/VB4_08062019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
#VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

#VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
#VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

#VB4 <- VB4%>%
#  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
#  select(DateTime,PPM,VID)%>%
#  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-08-01 15:00:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-08-01 21:00:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
#"#63ABF9"
outPlot2 <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #5 - August 01",x = "Time", y = "pCO2", colour = "Sensor")

ggplotly(outPlot2)
```


```{r inj6, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_08062019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_08062019_1min.csv"))
VB4<- read.csv(here::here("FieldData/Vaisala/VB4_08062019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
#VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB4 <- VB4%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3,VB4)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-08-05 14:00:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-08-05 21:00:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
outPlot1 <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9","#63ABF9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #6 - August 05", x = "Time", y = "pCO2", colour = "Sensor")

ggplotly(outPlot1)
```


```{r inj7, echo=FALSE, warning=FALSE}
VB1<- read.csv(here::here("FieldData/Vaisala/VB1_08092019_1min.csv"))
VB2<- read.csv(here::here("FieldData/Vaisala/VB2_08132019_1min.csv"))
VB3<- read.csv(here::here("FieldData/Vaisala/VB3_08092019_1min.csv"))
VB4<- read.csv(here::here("FieldData/Vaisala/VB4_08092019_1min.csv"))

# Convert time to POSIXct in a new column called "DateTime"
VB1$DateTime <- paste0(VB1$Date," ",VB1$Time)
VB1$DateTime <- as.POSIXct(VB1$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

colnames(VB2) <- c("DateTime","Voltage")
#VB2$DateTime <- paste0(VB2$Date," ",VB1$Time)
VB2$DateTime <- as.POSIXct(VB2$DateTime, format = "%m/%d/%Y %H:%M")

# Correct time offset
#VB2$DateTime <- VB2$DateTime - 3600


VB3$DateTime <- paste0(VB3$Date," ",VB3$Time)
VB3$DateTime <- as.POSIXct(VB3$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

VB4$DateTime <- paste0(VB4$Date," ",VB4$Time)
VB4$DateTime <- as.POSIXct(VB4$DateTime, format = "%m/%d/%Y %I:%M:%S %p")

# Format the data, adjust based on field calibration and remove duplicate rows
VB1 <- VB1%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)-5,VID="V1")%>%
  dplyr::select(DateTime,PPM,VID)%>%
  distinct()

VB2 <- VB2%>%
  dplyr::mutate(PPM=(Voltage * 10)-30,VID="V2")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB3 <- VB3%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V3")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

VB4 <- VB4%>%
  dplyr::mutate(PPM=(Voltage..V. * 10000)+17.5,VID="V4")%>%
  select(DateTime,PPM,VID)%>%
  distinct()

# Combine data and make the ID field a factor so it is groupable
VMerge <- rbind(VB1,VB2,VB3,VB4)%>%
  filter(PPM > 100)%>%
  filter(PPM < 10000)

# Time Filter
filt <- VMerge%>%
  filter(DateTime > as.POSIXct("2019-08-08 12:00:00", format = "%Y-%m-%d %H:%M:%S"))%>%
  filter(DateTime < as.POSIXct("2019-08-08 16:00:00", format = "%Y-%m-%d %H:%M:%S"))

# Make a simple plot
outPlot <- ggplot(filt, aes(x = DateTime, y = PPM, group = VID))+
  scale_color_manual(values=c("#1A5807", "#F3C519", "#1B48A9","#63ABF9"))+
  geom_point(aes(col=VID), size = 1) +
  labs(title = "Injection #7 - August 08", x = "Time", y = "pCO2", colour = "Sensor")

ggplotly(outPlot)
```